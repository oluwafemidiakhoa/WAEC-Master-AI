<!DOCTYPE html>
<html>
<head>
    <title>Error Logger</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .error { color: red; background: #ffe6e6; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .success { color: green; background: #e6ffe6; padding: 10px; margin: 5px 0; border-radius: 4px; }
        .info { color: blue; background: #e6f3ff; padding: 10px; margin: 5px 0; border-radius: 4px; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîç Error Logger - Real-time Error Detection</h1>
    
    <button onclick="testWeakTopics()">Test Weak Topics</button>
    <button onclick="testAIFeatures()">Test AI Features</button>
    <button onclick="clearLog()">Clear Log</button>
    
    <div id="log"></div>
    
    <script>
        // Capture all errors
        let errorCount = 0;
        
        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            logDiv.appendChild(div);
            console.log(`[${type}] ${message}`);
        }
        
        // Capture JavaScript errors
        window.addEventListener('error', function(e) {
            errorCount++;
            log(`ERROR ${errorCount}: ${e.message}<br>File: ${e.filename}<br>Line: ${e.lineno}`, 'error');
        });
        
        window.addEventListener('unhandledrejection', function(e) {
            errorCount++;
            log(`PROMISE ERROR ${errorCount}: ${e.reason}`, 'error');
        });
        
        function clearLog() {
            document.getElementById('log').innerHTML = '';
            errorCount = 0;
        }
        
        function testWeakTopics() {
            log('üß™ Testing Weak Topics Button...', 'info');
            try {
                // Test what happens when we click weak topics
                if (typeof window.app === 'undefined') {
                    log('‚ùå window.app is undefined!', 'error');
                    return;
                } else {
                    log('‚úÖ window.app exists', 'success');
                }
                
                if (typeof window.app.startMixedTopicPractice === 'function') {
                    log('‚úÖ startMixedTopicPractice function exists', 'success');
                    const result = window.app.startMixedTopicPractice();
                    log('‚úÖ startMixedTopicPractice executed successfully', 'success');
                } else {
                    log('‚ùå startMixedTopicPractice function missing!', 'error');
                }
                
            } catch (error) {
                log(`‚ùå Weak Topics Test Failed: ${error.message}<br>Stack: ${error.stack}`, 'error');
            }
        }
        
        function testAIFeatures() {
            log('ü§ñ Testing AI Features...', 'info');
            
            const tests = [
                { name: 'Smart Hints', func: 'demoSmartHints' },
                { name: 'Teacher Alerts', func: 'demoStudentAlerts' },
                { name: 'Parent Reports', func: 'showParentReport' },
                { name: 'Test All Features', func: 'testNewFeatures' }
            ];
            
            tests.forEach(test => {
                try {
                    if (typeof window.app === 'undefined') {
                        log(`‚ùå ${test.name}: window.app is undefined!`, 'error');
                        return;
                    }
                    
                    if (typeof window.app[test.func] === 'function') {
                        log(`‚úÖ ${test.name}: Function exists`, 'success');
                        window.app[test.func]();
                        log(`‚úÖ ${test.name}: Executed successfully`, 'success');
                    } else {
                        log(`‚ùå ${test.name}: Function ${test.func} missing!`, 'error');
                    }
                    
                } catch (error) {
                    log(`‚ùå ${test.name} Failed: ${error.message}`, 'error');
                }
            });
        }
        
        // Load scripts and test
        log('üöÄ Starting comprehensive error detection...', 'info');
        
        // Load scripts one by one and report status
        const scripts = [
            'assets/utils.js',
            'assets/storage.js', 
            'assets/selector.js',
            'assets/analytics.js',
            'assets/ui.js',
            'assets/app.js'
        ];
        
        let loadedScripts = 0;
        
        scripts.forEach((script, index) => {
            const scriptElement = document.createElement('script');
            scriptElement.src = script;
            scriptElement.onload = function() {
                loadedScripts++;
                log(`‚úÖ Script loaded: ${script}`, 'success');
                
                if (loadedScripts === scripts.length) {
                    log('üéØ All scripts loaded! Initializing app...', 'info');
                    
                    setTimeout(() => {
                        try {
                            window.app = new WAECAceApp();
                            window.analytics = new Analytics();
                            log('‚úÖ App and Analytics initialized successfully!', 'success');
                            
                            log('üß™ Running automatic tests in 2 seconds...', 'info');
                            setTimeout(() => {
                                testWeakTopics();
                                testAIFeatures();
                            }, 2000);
                            
                        } catch (error) {
                            log(`‚ùå App initialization failed: ${error.message}<br>Stack: ${error.stack}`, 'error');
                        }
                    }, 500);
                }
            };
            
            scriptElement.onerror = function() {
                log(`‚ùå Script failed to load: ${script}`, 'error');
            };
            
            document.head.appendChild(scriptElement);
        });
        
    </script>
</body>
</html>